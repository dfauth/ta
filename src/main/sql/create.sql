DROP TABLE CODES;
CREATE TABLE IF NOT EXISTS CODES (
    CODE VARCHAR(255) NOT NULL,
    PRIMARY KEY (CODE)
);
DROP TABLE price;
CREATE TABLE IF NOT EXISTS price (
    _CODE VARCHAR(255) NOT NULL,
    _DATE DATETIME NOT NULL,
    _OPEN DECIMAL(8,3),
    _HIGH DECIMAL(8,3),
    _LOW DECIMAL(8,3),
    _CLOSE DECIMAL(8,3),
    _VOLUME INTEGER,
    PRIMARY KEY (_CODE, _DATE)
);
DROP TABLE VALUATION;
CREATE TABLE IF NOT EXISTS VALUATION (
    CODE VARCHAR(255) NOT NULL,
    _DATE DATETIME NOT NULL,
    RATING INTEGER,
    BUY INTEGER,
    HOLD INTEGER,
    SELL INTEGER,
    TARGET DECIMAL(8,3),
    PRIMARY KEY (CODE, _DATE)
);
DROP TABLE FUNDAMENTALLY_SOUND;
CREATE TABLE IF NOT EXISTS FUNDAMENTALLY_SOUND (
    _DATE DATETIME NOT NULL,
    CODE VARCHAR(255) NOT NULL,
    PRIMARY KEY (_DATE,CODE)
);
DROP TABLE INDX;
CREATE TABLE IF NOT EXISTS INDX (
    IDX VARCHAR(255) NOT NULL,
    _DATE DATETIME NOT NULL,
    CODE VARCHAR(255) NOT NULL,
    PRIMARY KEY (IDX,_DATE,CODE)
);
DROP TABLE TRADE;
CREATE TABLE IF NOT EXISTS TRADE (
    ID INTEGER NOT NULL AUTO_INCREMENT,
    CONFIRMATION_NO VARCHAR(255) NOT NULL,
    _DATE DATETIME NOT NULL,
    CODE VARCHAR(255) NOT NULL,
    SIZE INTEGER,
    PRICE DECIMAL(8,3),
    COST DECIMAL(8,2),
    SIDE INTEGER,
    NOTES TEXT,
    PRIMARY KEY(ID),
    UNIQUE (CONFIRMATION_NO)
    -- FOREIGN KEY (CODE) REFERENCES CODES(CODE)
);
DROP TABLE RANKING;
CREATE TABLE IF NOT EXISTS RANKING (
    ID INTEGER NOT NULL,
    ATDATE DATETIME NOT NULL,
    CODE VARCHAR(255) NOT NULL,
    _RANK INTEGER,
    PRIMARY KEY (ID,ATDATE,CODE)
);
DROP TABLE PAYMENT;
CREATE TABLE IF NOT EXISTS PAYMENT (
    ID INTEGER NOT NULL AUTO_INCREMENT,
    TYPE INTEGER NOT NULL,
    TXNDATE DATETIME NOT NULL,
    DETAIL VARCHAR(255) NOT NULL,
    VALUE DECIMAL(8,2) NOT NULL,
    BALANCE DECIMAL(12,2) NOT NULL,
    SIDE INTEGER,
    CODE VARCHAR(255),
    CONTRACTNO VARCHAR(255),
    PRIMARY KEY (ID),
    FOREIGN KEY (CODE) REFERENCES CODES(CODE)
);


